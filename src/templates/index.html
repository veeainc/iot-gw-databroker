<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
<title>Data Broker</title>
<link rel="shortcut icon" href="../static/images/favicon.png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
<link type="text/css"rel="stylesheet" href="../static/css/sweetalert.css">
<link type="text/css"rel="stylesheet" href="../static/css/select2.min.css">
<link type="text/css"rel="stylesheet" href="../static/css/bootstrap.min.css">
<link rel="stylesheet" type="text/css" href="../static/css/style.css">

<script src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<script src="../static/js/select2.min.js"></script>
<script src="../static/js/sweetalert.js"></script>
<script src="../static/js/custom.js"></script>


</head>
<body>
      <nav class="navbar navbar-expand-md navbar-light bg-light header-color">
        <div class="container">
           <div class="image-logo">
              <a href="#"><img class="" src="../static/images/logo.png" alt=""></a>
           </div>
           <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
           <span class="navbar-toggler-icon"></span>
           </button>
           <div id="navbarCollapse" class="collapse navbar-collapse">
              <ul class="nav navbar-nav ml-auto hideDiv">
                 <li class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown"><span><img class="" src="../static/images/profile.png" alt=""></span> Admin</a>
                    <div class="dropdown-menu dropdown-menu-right">
                       <a href="#" class="dropdown-item">Settings</a>
                       <div class="dropdown-divider"></div>
                       <a href="/"class="dropdown-item">Logout</a>
                    </div>
                 </li>
              </ul>
           </div>
        </div>
     </nav>

    <div class="background-color main-container">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">

                    <div class="form-msg"></div>
                    <div class="info-msg"></div>
			
                    <div class="formMain">
                        <div class="fornMainInner">

                            <form id="webServiceForm">
                                <div class="fornMainInnerTab form-group col-sm-12">
                                    <div class="row">
                                    <div class="col-sm-3">
                                    <label>Choose your web service</label>
                                    </div>

                                    <div class="col-sm-9 web-service-box">
                                    <select class="form-control webService select_box" name="web_service">
                                        <option value="">Please Select</option>
                                        <option value="azure">Azure</option>
                                        <option value="aws">AWS</option>
                                        <option value="sitesage">Sitesage</option>
                                    </select>
                                    <span class="error-msg"></span>
                                    </div>
                                    </div>
                                </div>
                                <div class="formBottomOptions">
                                    <div class="innerForm">
                                        <div class="formStrip form-group col-sm-12">
                                            <div class="row">
                                            <div class="col-sm-3">
                                            <label>ID scope</label>
                                            </div>
                                            <div class="col-sm-9">
                                            <input type="text" name="scope">
                                            <span class="error-msg"></span>
                                            </div>
                                            </div>
                                        </div>
                                        <!-- <div class="formStrip form-group col-sm-12 hideDiv">
                                            <div class="row">
                                                <div class="col-sm-3">
                                            <label>Model Identity</label>
                                            </div>
                                            <div class="col-sm-9">
                                            <input type="text" name="device_id">
                                            <span class="error-msg"></span>
                                            </div>
                                            </div>
                                        </div> -->
                                        <div class="formStrip form-group col-sm-12">
                                            <div class="row">
                                                <div class="col-sm-3">
                                            <label>Primary Key</label>
                                            </div>
                                            <div class="col-sm-9">
                                            <input type="text" name="primary_key">
                                            <span class="error-msg"></span>
                                            </div>
                                        </div>
                                        </div>
                                        <div class="formStrip submitBtn form-group col-sm-12 mt-1">
                                            <div class="row">
                                                <div class="col-sm-3">
                                            <label>&nbsp;</label>
                                            </div>
                                            <div class="col-sm-9" >
                                            <button type="button" class="fromSubmit">Register</button>
                                            </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
        <div class="row align-items-center">
           <div class="footer-logo col-sm-5"><img class="img-fluid" src="../static/images/powered.png"></div>
           <div class="copyright-txt col-sm-7">Copyright &copy; 2020 Veea</div>
        </div>
     </footer>
</body>


<script type="text/javascript">
    $(document).ready(function(){
        apiBaseUrl = "/";
        if(localStorage.getItem('info-submit-msg')=="success") {
            $('.form-msg').addClass('success').append('<i class="fa fa-info-circle mr-1 fc-dtheme"></i><span>Cloud details submitted to databroker</span>').fadeIn(2000).delay(6000).fadeOut(2000);
            localStorage.setItem('info-submit-msg', "");

        }
        if(localStorage.getItem('info-submit-msg')=="error") {
            $('.form-msg').addClass('error').append('<i class="fa fa-info-circle mr-1  fc-dtheme"></i><span>Some error has occurred while processing your request...!</span>').fadeIn(2000).delay(6000).fadeOut(2000);

        }

        $(document).on('change', 'select.webService', function (e) {
            var webService = $(this).val();
            if(webService !== '') {
                if(webService !== 'azure') {
                    $("select[name='web_service']").parent('.web-service-box').find('.error-msg').text('This service is not available...!').show().hide(6000);
                    $(this).val("");
                    return false;
                }
            }
        });
        $(document).on('click', 'button.fromSubmit', function (e) {
            var frmId = $(this).closest("form").attr('id');
            var isSubmit=1;
            var webServiceValue = $("#"+frmId+" select[name='web_service']").val();
            if(webServiceValue == '') {
                $("#"+frmId+" select[name='web_service']").parent('.web-service-box').find('.error-msg').text('Please select web service...!').show().hide(6000);
                return false;         
            }

            var scopeValue = $("#"+frmId+" input[name='scope']").val();
            if(scopeValue == '') {
                $("#"+frmId+" input[name='scope']").next('.error-msg').text('Please enter scope ID...!').show().hide(6000);
                return false;
            }

            // var deviceIdValue = $("#"+frmId+" input[name='device_id']").val();
            // if(deviceIdValue == '') {
            //     $("#"+frmId+" input[name='device_id']").next('.error-msg').text('Please enter model identity...!').show().hide(6000);
            //     return false;
            // }

            var primaryKeyValue = $("#"+frmId+" input[name='primary_key']").val();
            if(primaryKeyValue == '') {
                $("#"+frmId+" input[name='primary_key']").next('.error-msg').text('Please enter primary key...!').show().hide(6000);
                return false;
            }

            var connectionStringValue = $("#"+frmId+" input[name='connection_string']").val();
            if(connectionStringValue == '') {
                return false;
            }

            var formData = {};
            formData['webService'] = webServiceValue;
            formData['id_scope'] = scopeValue;
            // formData['model_identity'] = deviceIdValue;
            formData['group_symmetric_key'] = primaryKeyValue;

            $.ajax({
                url: apiBaseUrl + "submit",
                type: "POST",
                contentType: "application/json",
                async: true,
                data: JSON.stringify(formData)
            }).done(function(data) {
                if(data.duplicate=="True"){
                $('.info-msg').addClass('error').html('<i class="fa fa-info-circle mr-1 fc-dtheme"></i><span>Already Registered with these details.Please try using different entries.</span>').fadeIn(2000).delay(6000).fadeOut(2000);
                isSubmit=0;
               }
               if(data.duplicate=="False"){
                localStorage.setItem('info-submit-msg', "success");
                isSubmit=1;
                 location.reload(); 
               }
            }).fail(function(params) {
                // hide loader
                localStorage.setItem('info-submit-msg', "error");
            });

        });
        $('.select_box').select2();
    });
</script>

</html>

